<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oldneto â€” Simple Anonymous Chat</title>
  <style>
    :root{
      /* slightly lighter overall background */
      --bg0:#101824;
      --bg1:#121e2b;

      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.14);
      --text:rgba(245,248,255,.92);
      --muted:rgba(235,245,255,.65);

      --find-bg: rgba(120, 180, 255, 0.16);
      --find-bd: rgba(120, 180, 255, 0.34);
      --find-tx: rgba(220, 235, 255, 0.95);

      --media-bg: rgba(170, 140, 255, 0.16);
      --media-bd: rgba(170, 140, 255, 0.34);
      --media-tx: rgba(235, 225, 255, 0.95);

      --stop-bg: rgba(255, 210, 120, 0.14);
      --stop-bd: rgba(255, 210, 120, 0.32);
      --stop-tx: rgba(255, 242, 220, 0.95);

      --report-bg: rgba(255, 120, 120, 0.16);
      --report-bd: rgba(255, 120, 120, 0.36);
      --report-tx: rgba(255, 230, 230, 0.95);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      height:100vh;
      overflow:hidden;
      color:var(--text);
      background:
        radial-gradient(1200px 900px at 30% 15%, rgba(120,180,255,.14), transparent 60%),
        radial-gradient(1200px 900px at 70% 25%, rgba(170,140,255,.14), transparent 60%),
        radial-gradient(900px 700px at 50% 90%, rgba(255,210,120,.11), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }

    .shell{
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px 14px;
    }

    .card{
      width:min(980px, 100%);
      height:min(720px, calc(100vh - 44px));
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border-radius:22px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      backdrop-filter: blur(10px);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:520px;
    }

    .topbar{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 18px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-bottom:1px solid var(--stroke);
    }

    .brand{display:flex;align-items:baseline;gap:10px;}
    .brand .dot{
      width:10px;height:10px;border-radius:50%;
      background:rgba(120,180,255,.9);
      box-shadow:0 0 0 4px rgba(120,180,255,.12);
    }
    .brand h1{
      margin:0;
      font-weight:900;
      letter-spacing:.2px;
      font-size:24px;
      line-height:1.05;
    }
    .brand small{
      display:block;
      margin-top:3px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.2px;
      font-weight:600;
    }

    .status{opacity:0;user-select:none}

    .main{
      flex:1 1 auto;
      display:flex;
      gap:14px;
      padding:14px;
      min-height:0;
    }

    .chat-wrap{
      flex:1 1 auto;
      border:1px solid var(--stroke);
      border-radius:18px;
      background:linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.14));
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    .chat{
      flex:1 1 auto;
      padding:16px 16px 12px 16px;
      overflow:auto;
      min-height:0;
      scroll-behavior:smooth;
    }

    .sys{
      color:rgba(255,255,255,.72);
      font-size:13px;
      font-weight:700;
      letter-spacing:.15px;
      text-align:center;
      padding:10px 0 14px;
      opacity:.95;
    }

    .msg{
      max-width:76%;
      padding:10px 12px;
      border-radius:14px;
      margin:8px 0;
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-size:14px;
      line-height:1.35;
      word-wrap:break-word;
      white-space:pre-wrap;
    }
    .msg.me{margin-left:auto;background:rgba(120,180,255,.10);border-color:rgba(120,180,255,.22);}
    .msg.other{margin-right:auto;background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.12);}
    .msg.media{padding:10px;}
    .msg.media img,.msg.media video{
      display:block;max-width:100%;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:black;
    }
    .msg.media video{width:100%;max-height:320px;}
    .meta{
      display:block;margin-top:6px;
      font-size:12px;color:rgba(235,245,255,.66);
      font-weight:700;letter-spacing:.1px;
    }

    .composer{
      flex:0 0 auto;
      border-top:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      padding:12px;
      display:flex;
      gap:10px;
      align-items:center;
    }

    #msg{
      flex:1;
      border:1px solid var(--stroke2);
      background:rgba(0,0,0,.18);
      color:var(--text);
      border-radius:16px;
      padding:12px 14px;
      outline:none;
      font-size:14px;
      min-width:0;
    }
    #msg::placeholder{color:rgba(235,245,255,.50);font-weight:600}

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }

    button{
      appearance:none;
      border:1px solid var(--stroke2);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:12px 16px;
      border-radius:18px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      letter-spacing:.2px;
      user-select:none;
      transition: transform .08s ease, background .18s ease, border-color .18s ease, filter .18s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      min-width:96px;
    }
    button:hover{ background:rgba(255,255,255,.12); }
    button:active{ transform: translateY(1px) scale(.98); }
    button:disabled{ opacity:.45; cursor:not-allowed; filter:grayscale(40%); }

    #btnFind{background:var(--find-bg);border-color:var(--find-bd);color:var(--find-tx);}
    #btnPhoto,#btnVideo{background:var(--media-bg);border-color:var(--media-bd);color:var(--media-tx);}
    #btnStop{background:var(--stop-bg);border-color:var(--stop-bd);color:var(--stop-tx);}
    #btnReport{background:var(--report-bg);border-color:var(--report-bd);color:var(--report-tx);}

    .footer{
      flex:0 0 auto;
      padding:10px 16px 14px;
      border-top:1px solid var(--stroke);
      color:rgba(235,245,255,.62);
      font-size:12px;
      text-align:center;
      line-height:1.25;
      background:rgba(0,0,0,.08);
    }
    .footer strong{color:rgba(245,248,255,.88)}
    .footer a{color:rgba(180,210,255,.85); text-decoration:none; font-weight:800}
    .footer a:hover{text-decoration:underline}
    .media-note{margin-top:6px;font-size:12px;color:rgba(235,245,255,.70);font-weight:700;letter-spacing:.1px;}

    #gate{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
      background:rgba(0,0,0,.62);
      backdrop-filter: blur(6px);
      z-index:9999;
    }
    .gate-card{
      width:min(720px, 100%);
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg, rgba(20,28,38,.92), rgba(10,14,18,.92));
      border-radius:22px;
      box-shadow: 0 22px 70px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .gate-top{
      padding:16px 18px;
      border-bottom:1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .gate-top .ttl{font-size:16px;font-weight:1000;letter-spacing:.2px;}
    .gate-body{
      padding:16px 18px 10px;
      color:rgba(245,248,255,.88);
      font-size:13px;
      line-height:1.35;
    }
    .gate-body ul{
      margin:10px 0 0 18px;
      padding:0;
      color:rgba(235,245,255,.78);
      font-weight:700;
    }
    .gate-note{margin-top:12px;color:rgba(235,245,255,.72);font-size:12px;font-weight:800;}
    .gate-actions{
      display:flex;
      gap:10px;
      justify-content:center;
      padding:14px 18px 18px;
      border-top:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
    }
    #btnAgree{
      min-width:160px;
      background:rgba(120,180,255,.18);
      border-color:rgba(120,180,255,.35);
      color:rgba(220,235,255,.95);
    }
    #btnDecline{
      min-width:160px;
      background:rgba(255,120,120,.14);
      border-color:rgba(255,120,120,.32);
      color:rgba(255,230,230,.95);
    }

    #incoming{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      background:rgba(0,0,0,.62);
      backdrop-filter: blur(6px);
      z-index:9998;
    }
    .incoming-card{
      width:min(720px, 100%);
      border:1px solid rgba(255,255,255,.14);
      background:linear-gradient(180deg, rgba(16,22,30,.94), rgba(8,12,16,.94));
      border-radius:22px;
      box-shadow: 0 22px 70px rgba(0,0,0,.65);
      overflow:hidden;
    }
    .incoming-top{
      padding:14px 18px;
      border-bottom:1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .incoming-top .ttl{font-size:14px;font-weight:1000;letter-spacing:.2px;}
    .incoming-body{
      padding:14px 18px 10px;
      color:rgba(245,248,255,.88);
      font-size:13px;
      line-height:1.35;
    }
    .incoming-preview{
      margin-top:10px;
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      overflow:hidden;
      background:rgba(255,255,255,.04);
    }
    .incoming-preview img,.incoming-preview video{width:100%;display:block;background:black;}
    .incoming-actions{
      display:flex;
      gap:10px;
      justify-content:center;
      padding:14px 18px 18px;
      border-top:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.03);
    }
    #btnAccept{
      min-width:160px;
      background:rgba(120,180,255,.18);
      border-color:rgba(120,180,255,.35);
      color:rgba(220,235,255,.95);
    }
    #btnThisLine{
      min-width:160px;
      background:rgba(255,255,255,.10);
      border-color:rgba(255,255,255,.22);
      color:rgba(245,248,255,.92);
    }

    @media (max-width: 720px){
      .shell{padding:14px 10px}
      .card{height:calc(100vh - 28px)}
      .composer{flex-direction:column; align-items:stretch}
      .btnrow{justify-content:stretch}
      button{width:100%}
    }
  </style>
</head>

<body>
  <div id="gate">
    <div class="gate-card">
      <div class="gate-top">
        <div class="ttl">18+ / Adults Only</div>
        <div class="ttl" style="opacity:.55;font-weight:900">Oldneto</div>
      </div>
      <div class="gate-body">
        <div style="font-weight:900;letter-spacing:.15px">
          By clicking <strong>I Agree</strong>, you confirm you are 18+ and accept the rules below.
        </div>
        <ul>
          <li>Strictly prohibited: any content involving minors, grooming, sexual exploitation, or CSAM.</li>
          <li>No illegal content, threats, harassment, hate, violence, or doxxing.</li>
          <li>No spam, scams, or attempts to collect personal data.</li>
          <li>You are responsible for what you share. Use <strong>Stop</strong> and <strong>Report</strong> if needed.</li>
        </ul>
        <div class="gate-note">
          You also accept our <a href="/terms.html" target="_blank" rel="noopener">Terms</a> and
          <a href="/privacy.html" target="_blank" rel="noopener">Privacy Policy</a>.
        </div>
      </div>
      <div class="gate-actions">
        <button id="btnAgree" type="button">I Agree</button>
        <button id="btnDecline" type="button">Decline</button>
      </div>
    </div>
  </div>

  <div id="incoming">
    <div class="incoming-card">
      <div class="incoming-top">
        <div class="ttl" id="incomingTitle">Incoming media</div>
        <div class="ttl" style="opacity:.55;font-weight:900">Accept to view</div>
      </div>
      <div class="incoming-body">
        <div id="incomingText">Your partner wants to send you media. Accept to receive it, or choose This line.</div>
        <div class="incoming-preview" id="incomingPreview" style="display:none"></div>
      </div>
      <div class="incoming-actions">
        <button id="btnAccept" type="button">Accept</button>
        <button id="btnThisLine" type="button">This line</button>
      </div>
    </div>
  </div>

  <div class="shell">
    <div class="card">
      <div class="topbar">
        <div class="brand">
          <span class="dot"></span>
          <div>
            <h1>Oldneto</h1>
            <small>simple anonymous chat</small>
          </div>
        </div>
        <div class="status" id="status">online</div>
      </div>

      <div class="main">
        <div class="chat-wrap">
          <div class="chat" id="chat">
            <div class="sys" id="sys">Ready. Tap Find to start.</div>
          </div>

          <div class="composer">
            <input id="msg" type="text" autocomplete="off" placeholder="Type a messageâ€¦" />
            <div class="btnrow">
              <button id="btnFind" type="button">Find</button>
              <button id="btnPhoto" type="button">Photo</button>
              <button id="btnVideo" type="button">Video</button>
              <button id="btnStop" type="button">Stop</button>
              <button id="btnReport" type="button">Report</button>
            </div>
          </div>

          <div class="footer">
            <div class="media-note">
              Media limits: photos accepted with confirmation; videos up to <strong>10 seconds</strong>, max <strong>40 MB</strong>.
            </div>
            <div style="margin-top:6px">
              Friendly chat. If someone breaks the rules â€” use <strong>Stop</strong> and <strong>Report</strong>.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <input id="photoInput" type="file" accept="image/*" style="display:none" />
  <input id="videoInput" type="file" accept="video/*" style="display:none" />

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("msg");

    const btnAgree = document.getElementById("btnAgree");
    const btnDecline = document.getElementById("btnDecline");
    const gate = document.getElementById("gate");

    const btnFind  = document.getElementById("btnFind");
    const btnStop  = document.getElementById("btnStop");
    const btnReport= document.getElementById("btnReport");
    const btnPhoto = document.getElementById("btnPhoto");
    const btnVideo = document.getElementById("btnVideo");

    const photoInput = document.getElementById("photoInput");
    const videoInput = document.getElementById("videoInput");

    const incoming = document.getElementById("incoming");
    const incomingTitle = document.getElementById("incomingTitle");
    const incomingText = document.getElementById("incomingText");
    const incomingPreview = document.getElementById("incomingPreview");
    const btnAccept = document.getElementById("btnAccept");
    const btnThisLine = document.getElementById("btnThisLine");

    const socket = io();

    let agreed = false;
    let pendingType = null;
    let waitingDelivery = false;

    function scrollBottom(){
      chat.scrollTop = chat.scrollHeight;
    }

    function addSystem(text){
      const el = document.createElement("div");
      el.className = "sys";
      el.textContent = text;
      chat.appendChild(el);
      scrollBottom();
    }

    function addMessage(text, who="other"){
      const el = document.createElement("div");
      el.className = "msg " + who;
      el.textContent = text;
      chat.appendChild(el);
      scrollBottom();
    }

    function normalizeDataUrl(payload){
      if (!payload) return "";
      if (typeof payload === "string") return payload;
      if (typeof payload === "object"){
        if (typeof payload.dataUrl === "string") return payload.dataUrl;
        if (typeof payload.url === "string") return payload.url;
        if (typeof payload.data === "string") return payload.data;
      }
      return "";
    }

    function addMedia(kind, payload, who="other"){
      const dataUrl = normalizeDataUrl(payload);
      if (!dataUrl) return;

      const wrap = document.createElement("div");
      wrap.className = "msg media " + who;

      if(kind === "photo"){
        const img = document.createElement("img");
        img.src = dataUrl;
        wrap.appendChild(img);
      } else {
        const vid = document.createElement("video");
        vid.src = dataUrl;
        vid.controls = true;
        vid.playsInline = true;
        wrap.appendChild(vid);
      }

      const meta = document.createElement("span");
      meta.className = "meta";
      meta.textContent = kind === "photo" ? "Photo" : "Video";
      wrap.appendChild(meta);

      chat.appendChild(wrap);
      scrollBottom();
    }

    function setControlsEnabled(on){
      input.disabled = !on;
      btnFind.disabled = !on;
      btnStop.disabled = !on;
      btnReport.disabled = !on;
      btnPhoto.disabled = !on;
      btnVideo.disabled = !on;
    }

    setControlsEnabled(false);

    btnAgree.addEventListener("click", () => {
      agreed = true;
      gate.style.display = "none";
      setControlsEnabled(true);
      socket.emit("agree");
      addSystem("Accepted. Loadingâ€¦");
    });

    btnDecline.addEventListener("click", () => {
      agreed = false;
      addSystem("You declined. Access is not available.");
      setControlsEnabled(false);
    });

    function requireAgree(){
      if(!agreed){
        gate.style.display = "flex";
        setControlsEnabled(false);
        return false;
      }
      return true;
    }

    function find(){
      if(!requireAgree()) return;
      addSystem("Searchingâ€¦");
      socket.emit("find");
    }

    function stop(){
      if(!requireAgree()) return;
      socket.emit("stop");
      addSystem("Stopped");
    }

    function report(){
      if(!requireAgree()) return;
      socket.emit("report");
      addSystem("Report sent.");
    }

    btnFind.addEventListener("click", find);
    btnStop.addEventListener("click", stop);
    btnReport.addEventListener("click", report);

    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && input.value.trim()){
        if(!requireAgree()) return;
        const text = input.value.trim();
        addMessage(text, "me");
        socket.emit("message", text);
        input.value = "";
      }
    });

    function readFileAsDataUrl(file){
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onload = () => resolve(String(r.result || ""));
        r.onerror = reject;
        r.readAsDataURL(file);
      });
    }

    async function validateVideoDuration(file, maxSeconds){
      const url = URL.createObjectURL(file);
      try{
        const v = document.createElement("video");
        v.preload = "metadata";
        v.src = url;
        await new Promise((resolve, reject) => {
          v.onloadedmetadata = resolve;
          v.onerror = reject;
        });
        const dur = v.duration || 0;
        return dur > 0 && dur <= maxSeconds;
      } finally {
        URL.revokeObjectURL(url);
      }
    }

    btnPhoto.addEventListener("click", () => {
      if(!requireAgree()) return;
      photoInput.value = "";
      photoInput.click();
    });

    btnVideo.addEventListener("click", () => {
      if(!requireAgree()) return;
      videoInput.value = "";
      videoInput.click();
    });

    photoInput.addEventListener("change", async () => {
      const file = photoInput.files && photoInput.files[0];
      if(!file) return;

      const maxMB = 40;
      if(file.size > maxMB * 1024 * 1024){
        addSystem("Photo too large.");
        return;
      }

      const dataUrl = await readFileAsDataUrl(file);
      socket.emit("photo_offer", dataUrl);
      addSystem("Photo sent for confirmationâ€¦");
    });

    videoInput.addEventListener("change", async () => {
      const file = videoInput.files && videoInput.files[0];
      if(!file) return;

      const maxMB = 40;
      const maxSeconds = 10;

      if(file.size > maxMB * 1024 * 1024){
        addSystem("Video too large.");
        return;
      }

      const okDur = await validateVideoDuration(file, maxSeconds);
      if(!okDur){
        addSystem("Video duration must be 10 seconds or less.");
        return;
      }

      const dataUrl = await readFileAsDataUrl(file);
      socket.emit("video_offer", dataUrl);
      addSystem("Video sent for confirmationâ€¦");
    });

    function openIncoming(type){
      pendingType = type;
      waitingDelivery = false;

      incomingTitle.textContent = type === "photo" ? "Incoming photo" : "Incoming video";
      incomingText.textContent = "Your partner wants to send you " + (type === "photo" ? "a photo" : "a video") + ". Accept to receive it, or choose This line.";

      incomingPreview.style.display = "none";
      incomingPreview.innerHTML = "";

      btnAccept.disabled = false;
      btnThisLine.disabled = false;

      incoming.style.display = "flex";
    }

    function closeIncoming(){
      incoming.style.display = "none";
      pendingType = null;
      waitingDelivery = false;
      incomingPreview.innerHTML = "";
      incomingPreview.style.display = "none";
      btnAccept.disabled = false;
      btnThisLine.disabled = false;
    }

    btnAccept.addEventListener("click", () => {
      if(!requireAgree()) return;
      if(!pendingType) return;

      waitingDelivery = true;
      btnAccept.disabled = true;
      btnThisLine.disabled = true;
      incomingText.textContent = "Accepted. Receivingâ€¦";

      if(pendingType === "photo") socket.emit("photo_accept");
      if(pendingType === "video") socket.emit("video_accept");
    });

    btnThisLine.addEventListener("click", () => {
      if(!requireAgree()) return;
      if(!pendingType) return;

      if(pendingType === "photo") socket.emit("photo_decline");
      if(pendingType === "video") socket.emit("video_decline");

      closeIncoming();
      addSystem("Declined.");
    });

    socket.on("banned", () => {
      gate.style.display = "flex";
      setControlsEnabled(false);
      addSystem("Access blocked.");
    });

    socket.on("searching", () => addSystem("Searchingâ€¦"));
    socket.on("matched", () => addSystem("Connected. Say hi ðŸ‘‹"));
    socket.on("partner_left", () => addSystem("Partner left the chat."));
    socket.on("stopped", () => addSystem("Stopped."));
    socket.on("report_received", () => addSystem("Report received."));
    socket.on("reported_and_banned", () => addSystem("You were reported and removed."));

    socket.on("message", (m) => addMessage(String(m || ""), "other"));

    socket.on("photo_sent", () => addSystem("Photo offer sent."));
    socket.on("video_sent", () => addSystem("Video offer sent."));

    socket.on("photo_request", () => openIncoming("photo"));
    socket.on("video_request", () => openIncoming("video"));

    function onDelivered(kind, payload){
      addMedia(kind, payload, "other");
      if(waitingDelivery) closeIncoming();
    }

    socket.on("photo_deliver", (payload) => onDelivered("photo", payload));
    socket.on("video_deliver", (payload) => onDelivered("video", payload));

    socket.on("photo", (payload) => onDelivered("photo", payload));
    socket.on("video", (payload) => onDelivered("video", payload));
  </script>
</body>
</html>

